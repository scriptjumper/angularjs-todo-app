# AngularJS Todo App

## Setting up an AngularJS App

### Installing Startup Packages

Firstly you need to make sure you have node and npm installed if not please go <a href='https://nodejs.org/en/' target='_blank'>here</a> and follow the installation process to setup you machine.

Let’s first create main directory:

```
$ mkdir angularjs-todo-app && cd angularjs-todo-app
```

#### Packages

For this project we will install the packages we need via `npm` instead of using the `cdn` links that is imported in the `html` file

Firstly, we need to initialise our `package.json` file, we do that by running this command:

```
$ npm init -y
```

Now we can install the packages we need to setup the AngularJS app.

We will be using the following packages:

- angular
- angular-route
- bootstrap
- prettier
- angular-cookies
- jQuery

Update the dependencies in the `package.json` with the following code:

```
...

"dependencies": {
    "angular-route": "^1.2.32",
    "bootstrap": "^4.4.1",
    "jquery": "^3.4.1",
    "prettier": "^2.0.2"
  },

...
```

then we running the command below:

```
$ npm i && npm ci
```

Once that’s done installing, let’s run the command below to create files for our `prettier` package and a `gitignore` file to handle files we do not want to add to github:

```
$ touch .prettierrc .gitignore
```

Open the `.prettierrc` file and update add the code below:

```
{
  "singleQuote": true,
  "printWidth": 160,
  "jsxBracketSameLine": true,
  "semi": false,
  "tabWidth": 2,
  "trailingComma": "none",
  "bracketSpacing": true
}
```

Open the `.gitignore` file and update add the code below:

```
# Logs
logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules
jspm_packages

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history
```

For the code I use in my `.gitignore` file I get the code from <a href="https://github.com/executeautomation/gitignore" target="_blank">executeautomation</a>.

## Starting our app

Let’s first create our main file:

`index.html`, which will be linked to our external files and will serve as the primary template for our application.

In the main directory create `index.html` and add the code below:

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo App</title>

    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css" />

  </head>
  <body>
    <h1>Hello World!</h1>

    <!-- Libs -->
    <script src="node_modules/angular/angular.js"></script>
    <script src="node_modules/@uirouter/angularjs/release/angular-ui-router.js"></script>
  </body>
</html>
```

To test that all our imports is working we need to run our app.
For this app I am using <a href="https://www.npmjs.com/package/lite-server" target="_blank">lite-server</a>, to install `lite-server` we run this command:

```
$ npm install lite-server --save-dev
```

...and add a "script" entry within your project's `package.json` file:

```
# Inside package.json...
"scripts": {
    "dev": "lite-server"
},
```

With the above script entry, you can then start lite-server via:

```
$ npm run dev
```

Once the above command is running, in your browser of choice go to `http://localhost:3000` (by default `lite-server` will open a new tab in your default browser that is opened to `http://localhost:3000`).

## Creating First View and Controller

### Setting Up First Route

In the `app/` directory, we will be creating `app.js` file with the code below:

```
;(function () {
  angular.module('TodoApp', ['ngRoute', 'ngCookies']).config([
    '$routeProvider',
    function ($routeProvider) {
      $routeProvider
        .when('/', {
          controller: 'TaskCtrl',
          templateUrl: 'views/todoTasks.html'
        })
        .otherwise({ redirectTo: '/' })
    }
  ])
})()
```

Next, we create a view and controller file for out route.

In the `app/controllers` directory, we will be creating `TaskCtrl.js` file with the code below:

```
;(function () {
  angular.module('TodoApp').controller('TaskCtrl', [
    '$scope', function ($scope) {
      ...
    }
  ])
})()
```

Then, In the `views/` directory, we will be creating `tasks.html` file with some placeholder code:

```
<h1>Hello Form tasks.html</h1>
```

Finally we change the `body` in our `index.html` file to start using AngularJS.
We do this with the code below:

```
<body>
  <div ng-app="TodoApp">
    <div class="container">
      <div ng-view></div>
    </div>
  </div>

...
```

### Setting Up Login Route

We'll start in the `app.js`, add the code below to setup the login route:

```
...
.when('/login', {
  controller: 'AuthCtrl',
  templateUrl: 'views/auth.html'
})
...
```

Next, we create the `auth.html` view file in `views/` with a basic login form code:

```
<div class="container">
  <div class="col-md-6 mx-auto text-center">
    <div class="header-title">
      <h1 class="wv-heading--title">
        Check out — it’s free!
      </h1>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 mx-auto">
      <div class="myform form">
        <form name="form" role="form">
          <div class="form-group">
            <input type="email" name="email" id="email" class="form-control" placeholder="Email" required />
          </div>
          <div class="form-group">
            <input type="password" name="password" id="password" class="form-control" placeholder="Password" required />
          </div>
          <div class="text-center">
            <button type="submit" class="btn btn-block send-button tx-tfm">Login</button>
          </div>

          <p class="small mt-3">Are you new? why don't you create an account <a href="#" class="ps-hero__content__link">here</a>.</p>
        </form>
      </div>
    </div>
  </div>
</div>
```

In the `app/controllers` directory, we will be creating `AuthCtrl.js` file with the code below:

```
;(function () {
  angular.module('TodoApp').controller('AuthCtrl', [
    '$scope', function ($scope) {
      ...
    }
  ])
})()
```

In the main directory we create our custom stylings, create the `app.css` file, with the code below:

```
body {
  background-color: darkgray;
}

.send-button {
  background: #54c7c3;
  width: 100%;
  font-weight: 600;
  color: #fff;
  padding: 8px 25px;
}

p.small {
  font-size: 100%;
}

.g-button {
  color: #fff !important;
  border: 1px solid #ea4335;
  background: #ea4335 !important;
  width: 100%;
  font-weight: 600;
  color: #fff;
  padding: 8px 25px;
}

.my-input {
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  cursor: text;
  padding: 8px 10px;
  transition: border 0.1s linear;
}

.header-title {
  margin: 5rem 0;
}

h1 {
  font-size: 31px;
  line-height: 40px;
  font-weight: 600;
  color: #4c5357;
}

h2 {
  color: #5e8396;
  font-size: 21px;
  line-height: 32px;
  font-weight: 400;
}

.login-or {
  position: relative;
  color: #aaa;
  margin-top: 10px;
  margin-bottom: 10px;
  padding-top: 10px;
  padding-bottom: 10px;
}

.span-or {
  display: block;
  position: absolute;
  left: 50%;
  top: -2px;
  margin-left: -25px;
  background-color: #fff;
  width: 50px;
  text-align: center;
}

.hr-or {
  height: 1px;
  margin-top: 0px !important;
  margin-bottom: 0px !important;
}

@media screen and (max-width: 480px) {
  h1 {
    font-size: 26px;
  }
  h2 {
    font-size: 20px;
  }
}
```

### Setting Up Register Route

We'll start in the `app.js`, add the code below to setup the login route:

```
...
.when('/register', {
  controller: 'AuthCtrl',
  templateUrl: 'views/auth.html'
})
...
```

Next, we wont be creating a separate view for the registration form instead we will make the `views/auth.html` dynamic.
We do this with the code below:

```
<div class="row">
    <div class="col-md-6 mx-auto">
      <div class="myform form">
        <form name="form" ng-submit="submit()" role="form">
          <!-- only for regist form -->
          <div ng-if="showLoginForm === false" class="form-group">
            <input type="text" name="firstName" id="firstName" class="form-control" ng-model="firstName" placeholder="First Name" />
          </div>

          <div ng-if="showLoginForm === false" class="form-group">
            <input type="text" name="lastName" id="lastName" class="form-control" ng-model="lastName" placeholder="Last Name" />
          </div>
          <!-- only for regist form -->

          <div class="form-group">
            <input type="email" name="email" id="email" class="form-control" placeholder="Email" required />
            <span ng-show="form.email.$dirty && form.email.$error.required" class="help-block">Email is required</span>
          </div>

          <div class="form-group">
            <input type="password" name="password" id="password" class="form-control" placeholder="Password" required />
            <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span>
          </div>

          <div class="text-center">
            <button type="submit" ng-disabled="form.$invalid || dataLoading" class="btn btn-block send-button tx-tfm">{{formBtnName}}</button>
            <img
              ng-if="dataLoading"
              src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="
            />
          </div>

          <p class="small mt-3">{{formMessage}} <a ng-href="{{formLink}}" class="ps-hero__content__link">here</a></p>
        </form>
      </div>
      <br />
      <div ng-show="error" class="alert alert-danger">{{error}}</div>
    </div>
  </div>
```

In the `app/controllers` directory, we update the `AuthCtrl.js` file with the code below:

```
;(function () {
  angular.module('TodoApp').controller('AuthCtrl', [
    '$scope',
    '$location',
    function ($scope, $location) {
      constructor()

      $scope.submit = function () {
        $scope.dataLoading = true
        if ($scope.showLoginForm) {
          console.log('Handle User login')
          $scope.dataLoading = false
        } else {
          console.log('Handle User registration')
          $scope.dataLoading = false
        }
      }

      function constructor() {
        // check path to see which form to display
        $scope.showLoginForm = true
        $scope.formMessage = "Are you new? why don't you create an account "
        $scope.formLink = '/register'
        $scope.formBtnName = 'Login'
        var path = $location.path()
        if (path === '/register') {
          $scope.showLoginForm = false
          $scope.formMessage = 'Already have an account? just login '
          $scope.formLink = '/login'
          $scope.formBtnName = 'Register'
        }
      }
    }
  ])
})()
```

#### Templating Dynamic Auth Form

Open `AuthCtrl.js` and add the code below above the `constructor()` function:

```
// templating the text to display for both the login and register form
var loginFormDetails = {
    formMessage: "Are you new? why don't you create an account ",
    formLink: '/register',
    formBtnName: 'Login'
  },
  registerFormDetails = {
    formMessage: 'Already have an account? just login ',
    formLink: '/login',
    formBtnName: 'Register'
  }
```

In the `contructor()` function we replace all the code there with:

```
function constructor() {
  // check path to see which form to display
  $scope.showRegisterFields = false
  $scope.formDetails = loginFormDetails
  var path = $location.path()
  if (path === '/register') {
    $scope.showRegisterFields = true
    $scope.formDetails = registerFormDetails
  }
}
```

Now we make changes to our `auth.html`, for this we will only make changes to the elements/attributes in the `<form>....</form>`:

```
<form name="form" ng-submit="submit()" role="form">
  <!-- only for register form -->
  <div ng-show="showRegisterFields" class="form-group">
    <input type="text" name="firstName" id="firstName" class="form-control" ng-model="firstName" placeholder="First Name" />
  </div>

  <div ng-show="showRegisterFields" class="form-group">
    <input type="text" name="lastName" id="lastName" class="form-control" ng-model="lastName" placeholder="Last Name" />
  </div>
  <!-- only for register form -->

  ...
  ...
  ...

  <div class="text-center">
    <button type="submit" ng-disabled="form.$invalid || dataLoading" class="btn btn-block send-button tx-tfm">{{formDetails.formBtnName}}</button>
    <img
      ng-if="dataLoading"
      src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="
    />
  </div>

  <p class="small mt-3">{{formDetails.formMessage}} <a ng-href="{{formDetails.formLink}}" class="ps-hero__content__link">here</a></p>
</form>
```

## Creating Service

We will create a service to handle all our requests to the backend.

First we create a directory called `services/` in out `app/` directory.
Then we create our `authService.js` file in the `app/services/` directory with basic service code:

```
;(function () {
  angular.module('TodoApp').factory('AuthenticationService', [
    function () {
      var service = {}

      return service
    }
  ])
})()
```

Next we link the service in out `index.html` below the link to our `app/app.js` file:

```
...
<script src="app/app.js"></script>

<!-- Services -->
<script src="app/services/authService.js"></script>
...
```

### Sample Login/Register Services

#### Register Service

In our auth service file, we inject the services we will be using, we do that with the follow code:

```
angular.module('TodoApp').factory('AuthenticationService', [
    function () {
      '$http',
      '$cookieStore',
      '$rootScope',
      '$timeout',
      function ($http, $cookieStore, $rootScope, $timeout) {
        ....
      }
    }
])
```

Then, we create a register function that we will export to use in our auth controller:

```
function ($http, $cookieStore, $rootScope, $timeout) {
  var service = {}

  // temp function
  function getRandomItem(arr) {
    let items = arr
    let randomitem = Math.floor(Math.random() * items.length)
    return items[randomitem]
  }

  service.Register = function (firstName, lastName, email, password, callback) {
    // simulating a dummy server request
    $timeout(function () {
      var response = { success: getRandomItem([true, false]) }
      if (!response.success) {
        response.message = 'Failed to create user!'
      }
      callback(response)
    }, 1000)
  }

  return service
```

#### Login Service

Finally, In our Authentication Service we create our login function with the code below:

```
...

service.Login = function (email, password, callback) {
  // simulating a dummy server request
  $timeout(function () {
    var response = { success: email === 'testuser@tdd.com' && password === 'test' }
    if (!response.success) {
      response.message = 'Login failed, please check your username and password!'
    }
    callback(response)
  }, 1000)
}

...
```

##### Auth Controller

In our auth controller, we first inject our `AuthenticationService`:

```
angular.module('TodoApp').controller('AuthCtrl', [
    '$scope',
    '$location',
    'AuthenticationService',
    function ($scope, $location, AuthenticationService) {
```

Then, we create a function using the `$scope` service with the code below:

```
$scope.submit = function () {
  $scope.dataLoading = true
  if (!$scope.showRegisterFields) {
    AuthenticationService.Login($scope.email, $scope.password, function (response) {
      if (response.success) {
        $location.path('/')
      } else {
        $scope.error = response.message
        $scope.dataLoading = false
      }
    })
  } else {
    AuthenticationService.Register($scope.firstName, $scope.lastName, $scope.email, $scope.password, function (response) {
      if (response.success) {
        $location.path('/')
      } else {
        $scope.error = response.message
        $scope.dataLoading = false
      }
    })
  }
}
```

## Linking App To Backend

In our `app.js` with add a `.constant()` that will contain the url address to our backend url, after the `.config()` method close we add the follow:

```
.config(/* some code is already here eg routes to /, /login, /register */)
.constant('baseUrl', 'http://localhost:8000/api')
```
